# Stage 3/6: Route Performance Analysis
## Description
In this stage, as a novice data analyst, you need to examine the efficiency of flight routes by computing key metrics  
such as average flight duration, total passengers served, and income generated per route. This stage focuses on  
synthesizing data from various sources to derive insights into route profitability and passenger demand,  
helping optimize airline operations and resource allocation.

## Objectives
- Identify the unique routes by `CONCAT` the `town_from` and `town_to` from the `Trip` table, naming it `route`.
- Calculate the average flight duration in **minutes** for each route, where there may be multiple identical routes  
  with different flight durations. This average is denoted as `avg_flight_duration`.
- `COUNT` the total number of passengers who flew on each route, designated as `total_passengers`.
- Calculate the `SUM` income generated for each route, considering each second of flight as worth **1 cent**,  
  termed `total_income`. The final answer of `total_income` must be in **dollars**.
- Utilize the `JOIN` function to combine multiple tables correctly.
- `ORDER BY` the final result by `total_income` in descending order.
- The column order is essential.

### ChatGPT prompts that help to write the query
- Consider a scenario where you need to analyze data to identify unique routes. How would you approach formulating  
  an SQL query to accomplish this task?
- Now, imagine you've identified the unique routes. How would you proceed to calculate the average flight durations  
  for each route using SQL?
- After determining the average flight durations, how would you go about counting the total number of passengers for  
  each route in the dataset?
- Finally, consider the task of computing the total income generated for each route. How would you formulate an  
  SQL query to achieve this, taking into account factors such as flight duration and passenger counts?

Take a look at the following database structure:

![Explanation of the database](./STAGE1_IMG1.png)

## Explanation of the database:
The **`Airline Transportation Database`** encompasses four main tables: `Airline_Company`, `Trip`, `Passenger`, and `Pass_in_trip`.  
It facilitates the management of airline operations, storing critical information about airline companies, flights,  
passengers, and trip details.

In-depth details of each table are as follows:

`Airline_company`**: Serves as a repository for airline company information, providing a unique identifier for      
each company along with their respective names.
- `ID_comp`: Primary key representing the unique identifier for each airline company.
- `company_name`: Stores the name of the airline company, enabling identification and association with flight operations.

`Trip`**: Contains detailed information about each flight trip.
- `trip_no`: Primary key serving as a unique identifier for each flight trip.
- `ID_comp`: Foreign key referencing the ID_comp in the Airline_Company table, establishing a relationship between flights and airline companies.
- `plane_type`: Records the type of aircraft used for the flight.
- `town_from`: Indicates the departure city of the flight.
- `town_to`: Specifies the arrival city of the flight.
- `time_out`: Stores the departure time of the flight.
- `time_in`: Records the arrival time of the flight.

`Passenger`**: Maintains records of individual passengers.
- `ID_psg`: Primary key representing the unique identifier for each passenger.
- `passenger_name`: Stores the name of the passenger, facilitating passenger identification and management.

`Pass_in_trip`**: Serves as a bridge between passengers and trip details.
- `trip_no`: Foreign key referencing the trip_no in the Trip table, establishing a relationship between passengers and flights.
- `trip_date`: Records the date of the trip, allowing for chronological organization of passenger-trip associations.
- `ID_psg`: Foreign key referencing the ID_psg in the Passenger table, associating passengers with specific trips.
- `seat_number`: Indicates the seat number occupied by the passenger during the trip, providing seating information   
  for passenger tracking and flight organization.

### Additional information and rules to consider:
- flights operate daily, and the flight duration of any flight is less than a day; `town_from` <> `town_to`.
- time and date in the `time_out` and `time_in` are taken into account relative to one-time zone.
- `time_out` and `time_in` times are indicated accurate to the minute.
- `passenger_name` may have namesakes (same name field values).
- the `seat_number` in the cabin is a number with a letter; the number determines the number of the row  
  in the range from 01 to 99, and the letter (a – d) – the place in the row from left to right in alphabetical order.

** _Table names are case-sensitive._

Click on the [Database.sql](Database.sql) to download the SQL query for creating the database.

## Example

_Trip Table Example:_

| trip_no | ID_comp | plane_type  | town_from | town_to | time_out            | time_in             |
|---------|---------|-------------|-----------|---------|---------------------|---------------------|
| 1       | 1       | Boeing 737  | Chicago   | Miami   | 2024-02-23 08:00:00 | 2024-02-23 18:45:00 |
| 2       | 2       | Airbus A320 | New York  | Boston  | 2024-02-24 23:00:00 | 2024-02-25 08:00:00 |

_Pass_in_trip Table Example:_

| trip_no | trip_date           | ID_psg | seat_number |
|---------|---------------------|--------|-------------|
| 1       | 2024-02-23 00:00:00 | 1      | 01A         |
| 1       | 2024-02-23 00:00:00 | 1      | 21B         |
| 2       | 2024-02-24 00:00:00 | 2      | 30D         |
| 2       | 2024-02-24 00:00:00 | 2      | 05C         |
| 2       | 2024-02-24 00:00:00 | 2      | 86A         |

From the tables, we can observe a `route` from `town_from`: **Chicago** to `town_to`: **Miami** with a `trip_no`: **1**.  
This `route` has two occurrences in the `Trip` table, indicating a `total_passengers`: **2** .

The `avg_flight_duration` for this route is calculated by subtracting the `time_out` from the `time_in`,  
resulting in 10 hours and 45 minutes or **645** minutes. The `total_income` for this route is computed by multiplying  
the `avg_flight_duration` (converted to seconds) by the `total_passengers` and $0.01 per second, yielding **$774**.

Finally, the output table presents each `route`, its corresponding `avg_flight_duration`, `total_passengers`, and `total_income`,  
ordered by `total_income` in descending order:

| route           | avg_flight_duration | total_passengers | total_income |
|-----------------|---------------------|------------------|--------------|
| New York-Boston | 540                 | 3                | 972          |
| Chicago-Miami   | 645                 | 2                | 774          |

_From the output above, it can be seen that the order of the columns is `route` -> `avg_flight_duration` -> `total_passengers` -> `total_income`.  
The column order is essential._

## Query template:
```markdown
SELECT 
    CONCAT(... '-' ...) AS route, ...;
```