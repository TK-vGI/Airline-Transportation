# Stage 2/6: Identifying Key Passengers
## Description
In this stage as a data analyst, your task is to identify passengers who frequently fly with specific airline companies.  
By analyzing database records, you'll pinpoint passengers who have flown multiple times with particular airlines.  
This insight aids airlines in tailoring services to meet the needs of loyal customers.

## Objectives
- Combine passenger flight data from the `Passenger`, `Pass_in_trip`, `Trip`, and `Airline_company` tables to create an  
  overview of frequent flyers with specific airlines.
- Output the `passenger_name`, `COUNT` of the passenger's number of flights on a specific airline company as `num_flights`,  
  and airline `company_name`.
- To be listed as a frequent flyer the `num_flights` must be at least more than **1**.
- Utilize the `JOIN` function effectively to combine multiple tables accurately.
- Use the `GROUP BY` function to combine according to the `passenger_name` and `company_name`
- The column order is essential.

### ChatGPT prompts that help to write the query
- Consider a scenario where you need to analyze flight data to identify frequent flyers with specific airlines.  
  How would you effectively merge data from multiple sources using SQL JOINs to gather all the necessary  
  information for analysis?
- Once you've combined the relevant data, how would you use SQL aggregation functions to calculate the number of  
  flights each individual has taken with a particular airline? Think about how you would organize the data to  
  facilitate this calculation.
- To identify frequent flyers accurately, you'll need to filter the results based on certain conditions. How would you  
  utilize SQL clauses to ensure that only individuals who meet the criteria for being frequent flyers are included  
  in the final analysis?

Take a look at the following database structure:

![Explanation of the database](./STAGE1_IMG1.png)

## Explanation of the database:
The **`Airline Transportation Database`** encompasses four main tables: `Airline_Company`, `Trip`, `Passenger`, and `Pass_in_trip`.  
It facilitates the management of airline operations, storing critical information about airline companies, flights,  
passengers, and trip details.

In-depth details of each table are as follows:

`Airline_company`**: Serves as a repository for airline company information, providing a unique identifier for      
each company along with their respective names.
- `ID_comp`: Primary key representing the unique identifier for each airline company.
- `company_name`: Stores the name of the airline company, enabling identification and association with flight operations.

`Trip`**: Contains detailed information about each flight trip.
- `trip_no`: Primary key serving as a unique identifier for each flight trip.
- `ID_comp`: Foreign key referencing the ID_comp in the Airline_Company table, establishing a relationship between flights and airline companies.
- `plane_type`: Records the type of aircraft used for the flight.
- `town_from`: Indicates the departure city of the flight.
- `town_to`: Specifies the arrival city of the flight.
- `time_out`: Stores the departure time of the flight.
- `time_in`: Records the arrival time of the flight.

`Passenger`**: Maintains records of individual passengers.
- `ID_psg`: Primary key representing the unique identifier for each passenger.
- `passenger_name`: Stores the name of the passenger, facilitating passenger identification and management.

`Pass_in_trip`**: Serves as a bridge between passengers and trip details.
- `trip_no`: Foreign key referencing the trip_no in the Trip table, establishing a relationship between passengers and flights.
- `trip_date`: Records the date of the trip, allowing for chronological organization of passenger-trip associations.
- `ID_psg`: Foreign key referencing the ID_psg in the Passenger table, associating passengers with specific trips.
- `seat_number`: Indicates the seat number occupied by the passenger during the trip, providing seating information   
  for passenger tracking and flight organization.

### Additional information and rules to consider:
- flights operate daily, and the flight duration of any flight is less than a day; `town_from` <> `town_to`.
- time and date in the `time_out` and `time_in` are taken into account relative to one-time zone.
- `time_out` and `time_in` times are indicated accurate to the minute.
- `passenger_name` may have namesakes (same name field values).
- the `seat_number` in the cabin is a number with a letter; the number determines the number of the row  
  in the range from 01 to 99, and the letter (a – d) – the place in the row from left to right in alphabetical order.

** _Table names are case-sensitive._

Click on the [Database.sql](Database.sql) to download the SQL query for creating the database.

## Example

_Airline_company Table Example_:

| ID_comp | company_name      |
|---------|-------------------|
| 1       | Delta Airlines    |
| 2       | American Airlines |

_Passenger Table Example_:

| ID_psg | passenger_name |
|--------|----------------|
| 1      | John Smith     |
| 2      | Mary Johnson   |
| 3      | James Williams |

_Trip Table Example:_

| trip_no | ID_comp | plane_type  | town_from | town_to | time_out            | time_in             |
|---------|---------|-------------|-----------|---------|---------------------|---------------------|
| 1       | 1       | Boeing 737  | Chicago   | Miami   | 2024-02-23 08:00:00 | 2024-02-23 18:45:00 |
| 2       | 2       | Airbus A320 | New York  | Boston  | 2024-02-24 23:00:00 | 2024-02-25 08:00:00 |

_Pass_in_trip Table Example:_

| trip_no | trip_date           | ID_psg | seat_number |
|---------|---------------------|--------|-------------|
| 1       | 2024-02-23 00:00:00 | 1      | 01A         |
| 1       | 2024-02-23 00:00:00 | 1      | 21B         |
| 2       | 2024-02-24 00:00:00 | 2      | 30D         |
| 2       | 2024-02-24 00:00:00 | 2      | 05C         |
| 2       | 2024-02-24 00:00:00 | 2      | 86A         |

From the data presented in the table above, it is evident that `passenger_name`: `John Smith` with the `ID_psg`: `1` exists  
in the `Pass_in_trip` table 2 times. In both cases it aligned to the `trip_no`: `1`, consequently that `trip_no` in the `Trip`  
table aligned to the `ID_comp`: `1` which has the `company_name`: `Delta Airlines` in the `Airline_company` table.

The output table, after identifying the `passenger_name` having `num_flights` at least 1 on the specific airline companies :

| passenger_name | num_flights | company_name      |
|----------------|-------------|-------------------|
| John Smith     | 2           | Delta Airlines    |
| Mary Johnson   | 2           | American Airlines |

_From the output above, it can be seen that the order of the columns is `passenger_name` -> `num_flights` -> `company_name`_

## Query template:
```markdown
SELECT
   p.passenger_name, ...;
```